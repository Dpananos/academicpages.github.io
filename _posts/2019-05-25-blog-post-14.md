---
title: 'Gradient Descent for ODEs'
date: 2019-05-21
permalink: /posts/2019/05/blog-post-14/
tags:
---


Gradient descent usually isn't used to fit Ordinary Differential Equations (ODEs) to data (at least, that isn't how the Applied Mathematics departments to which I have been a part have done it).  Nevertheless, that doesn't mean that it can't be done.  For some of my recent GSoC work, I've been investigating how to compute gradients of solutions to ODEs without access to the solution's analytical form.  In this blog post, I describe how these gradients can be computed and how they can be used to fit ODEs to synchronous data with gradient descent.


## A Simple Non-Linear System

The SIR model is a simple model describing how the dynamics of a fictitious disease evolve through time.  Consider a closed, homogenously mixed, population comprised of people who are healthy ($S$) and people who are infected ($I$).  We drop a single index case of the disease into the population and see how the disease spreads among healthy people.  The ODEs are shown below:

$$ \dfrac{dS}{dt} = -\mathcal{R}_0 SI \quad S(0) = 0.99 $$
$$ \dfrac{dI}{dt} = \mathcal{R}_0 SI - I \quad I(0) = 0.01 $$

Here, $\mathca{R}_0$ is the basic reproductive ratio.  For compactness, let's refer to the vector of solutions as $u = \left< S(t), I(t) \right>$. You can think of it as the number of healthy people a single sick person would infect in the population per unit time.  Since this system only has one parameter, things become quite easy for us.  I'll simulate from this system, and then estimate $\mathcal{R}_0$ from the data.

## Computing Gradients for ODEs

Gradient descent for our model looks like

$$ \mathcal{R}_{0 n+1} = \mathcal{R}_{0n} - \alpha \nabla \mathcal{L}(u) $$

In order to compute the gradient of the loss, we need the gradient of the solution with respect to $\mathcal{R}_0$.  The gradient of the solution is the hard part here because it can not be computed (a) analytically, or (b) through automatic differentiation without differentiating through the numerical integration of our ODE.

Thankfully, years of research into ODEs yields a way to do this (that is not the adjoint method.  Surprise!  You thought I was going to say the adjoint method didn't you?).  For a system with $m$ parameters, $p_i$, to estimate, forward mode sensitivity analysis calculates gradients by extending the ODE system to include the following $m$ equations:

$$ \dfrac{d}{dt}\left( \dfrac{\partial u}{\partial p_i} \right) = \mathcal{J}_f \dfrac{\partial u}{\partial p_i} + \nabla_{p_i} f $$
